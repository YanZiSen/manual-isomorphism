{"version":3,"file":"server.js","mappings":";;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AASA;;;;;;;;;;;AC3BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;AC5EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACTA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACzFA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAHA;;;;;;;;;;;;;;;;;;;;;;;;ACNA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAHA;;;;;;;;;;;;;;;ACNA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAHA;;;;;;;;;;;;;;;;;ACZA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACVA;AACA;AACA;AAKA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAwDA;AAjDA;AAGA;AACA;AAEA;AACA;AACA;AAIA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAKA;;;;;;;;AAQA;;;;;AAKA;;;AAGA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;AChFA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAKA;AAKA;AAGA;AAOA;AALA;AACA;AACA;AACA;;;;;;;;;;;;;;;;AC1BA;AACA;AACA;AACA;AACA;AACA;AAIA;AACA;AAIA;AAXA;AAaA;;;;;;;;;;;;;;;;;;;;;;;;;AChBA;AACA;AAEA;AACA;AACA;AACA;AAKA;AAJA;AACA;AACA;AACA;;;;;;;;;;;;;;;;ACTA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;ACvBA;AAEA;AACA;AACA;AAFA;;;;;;;;;;;;ACFA;;;;;;;;;;;ACAA;;;;;;;;;;;ACAA;;;;;;;;;;;ACAA;;;;;;;;;;;ACAA;;;;;;;;;;;ACAA;;;;;;;;;;;ACAA;;;;;;;;;;;ACAA;;;;;;;;;;;ACAA;;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;ACvBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;ACPA;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;AENA;AACA;AACA;AACA","sources":["webpack://manual-isomorphism/./src/Home/index.less?369c","webpack://manual-isomorphism/./isomorphic-style-loader/dist/insertCss.js","webpack://manual-isomorphism/./src/Home/index.less","webpack://manual-isomorphism/./node_modules/css-loader4/dist/runtime/api.js","webpack://manual-isomorphism/./mock/list.ts","webpack://manual-isomorphism/./mock/news.ts","webpack://manual-isomorphism/./mock/user.ts","webpack://manual-isomorphism/./server/index.ts","webpack://manual-isomorphism/./server/pageRouter.tsx","webpack://manual-isomorphism/./src/Home/index.tsx","webpack://manual-isomorphism/./src/Layout.tsx","webpack://manual-isomorphism/./src/User/index.tsx","webpack://manual-isomorphism/./src/router.tsx","webpack://manual-isomorphism/./utils/useDataFromLoader.ts","webpack://manual-isomorphism/external commonjs \"express\"","webpack://manual-isomorphism/external commonjs \"isomorphic-style-loader/StyleContext\"","webpack://manual-isomorphism/external commonjs \"isomorphic-style-loader/useStyles\"","webpack://manual-isomorphism/external commonjs \"node-fetch\"","webpack://manual-isomorphism/external commonjs \"react-dom/server\"","webpack://manual-isomorphism/external commonjs \"react-router\"","webpack://manual-isomorphism/external commonjs \"react-router-dom/server\"","webpack://manual-isomorphism/external commonjs \"react/jsx-runtime\"","webpack://manual-isomorphism/external node-commonjs \"path\"","webpack://manual-isomorphism/webpack/bootstrap","webpack://manual-isomorphism/webpack/runtime/compat get default export","webpack://manual-isomorphism/webpack/runtime/define property getters","webpack://manual-isomorphism/webpack/runtime/hasOwnProperty shorthand","webpack://manual-isomorphism/webpack/runtime/make namespace object","webpack://manual-isomorphism/webpack/before-startup","webpack://manual-isomorphism/webpack/startup","webpack://manual-isomorphism/webpack/after-startup"],"sourcesContent":["\n    var refs = 0;\n    var getCss = (css) => {\n                console.log(css);\n                return css.default;\n              };\n    var css = getCss(require(\"!!../../node_modules/css-loader4/dist/cjs.js??ruleSet[1].rules[1].use[1]!../../node_modules/less-loader/dist/cjs.js!./index.less\"));\n    var insertCss = require(\"!../../isomorphic-style-loader/dist/insertCss.js\");\n    var content = typeof css === 'string' ? [[module.id, css, '']] : css;\n\n    exports = module.exports = css.locals || {};\n    exports._getContent = function() { return content; };\n    exports._getCss = function() { return '' + css; };\n    exports._insertCss = function(options) { return insertCss(content, options) };\n\n    // Hot Module Replacement\n    // https://webpack.github.io/docs/hot-module-replacement\n    // Only activated in browser context\n    if (module.hot && typeof window !== 'undefined' && window.document) {\n      var removeCss = function() {};\n      module.hot.accept(\"!!../../node_modules/css-loader4/dist/cjs.js??ruleSet[1].rules[1].use[1]!../../node_modules/less-loader/dist/cjs.js!./index.less\", function() {\n        css = require(\"!!../../node_modules/css-loader4/dist/cjs.js??ruleSet[1].rules[1].use[1]!../../node_modules/less-loader/dist/cjs.js!./index.less\");\n        content = typeof css === 'string' ? [[module.id, css, '']] : css;\n        removeCss = insertCss(content, { replace: true });\n      });\n      module.hot.dispose(function() { removeCss(); });\n    }\n  ","/*! Isomorphic Style Loader | MIT License | https://github.com/kriasoft/isomorphic-style-loader */\n\n'use strict';\n\nvar inserted = {};\nfunction b64EncodeUnicode(str) {\n  return btoa(encodeURIComponent(str).replace(/%([0-9A-F]{2})/g, function (match, p1) {\n    return String.fromCharCode(\"0x\" + p1);\n  }));\n}\nfunction removeCss(ids) {\n  ids.forEach(function (id) {\n    if (--inserted[id] <= 0) {\n      var elem = document.getElementById(id);\n      if (elem) {\n        elem.parentNode.removeChild(elem);\n      }\n    }\n  });\n}\nfunction insertCss(styles, _temp) {\n  var _ref = _temp === void 0 ? {} : _temp,\n    _ref$replace = _ref.replace,\n    replace = _ref$replace === void 0 ? false : _ref$replace,\n    _ref$prepend = _ref.prepend,\n    prepend = _ref$prepend === void 0 ? false : _ref$prepend,\n    _ref$prefix = _ref.prefix,\n    prefix = _ref$prefix === void 0 ? 's' : _ref$prefix;\n  var ids = [];\n  for (var i = 0; i < styles.length; i++) {\n    var _styles$i = styles[i],\n      moduleId = _styles$i[0],\n      css = _styles$i[1],\n      media = _styles$i[2],\n      sourceMap = _styles$i[3];\n    var id = \"\" + prefix + moduleId + \"-\" + i;\n    ids.push(id);\n    if (inserted[id]) {\n      if (!replace) {\n        inserted[id]++;\n        continue;\n      }\n    }\n    inserted[id] = 1;\n    var elem = document.getElementById(id);\n    var create = false;\n    if (!elem) {\n      create = true;\n      elem = document.createElement('style');\n      elem.setAttribute('type', 'text/css');\n      elem.id = id;\n      if (media) {\n        elem.setAttribute('media', media);\n      }\n    }\n    var cssText = css;\n    if (sourceMap && typeof btoa === 'function') {\n      cssText += \"\\n/*# sourceMappingURL=data:application/json;base64,\" + b64EncodeUnicode(JSON.stringify(sourceMap)) + \"*/\";\n      cssText += \"\\n/*# sourceURL=\" + sourceMap.file + \"?\" + id + \"*/\";\n    }\n    if ('textContent' in elem) {\n      elem.textContent = cssText;\n    } else {\n      elem.styleSheet.cssText = cssText;\n    }\n    if (create) {\n      if (prepend) {\n        document.head.insertBefore(elem, document.head.childNodes[0]);\n      } else {\n        document.head.appendChild(elem);\n      }\n    }\n  }\n  return removeCss.bind(null, ids);\n}\nmodule.exports = insertCss;\n//# sourceMappingURL=insertCss.js.map\n","// Imports\nimport ___CSS_LOADER_API_IMPORT___ from \"../../node_modules/css-loader4/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(true);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \".EjoAOH9llLZiIKIOlDX\\\\+tA\\\\=\\\\= {\\n  color: red;\\n  line-height: 30px;\\n  border: 1px solid #ccc;\\n  border-radius: 5px;\\n}\\n\", \"\",{\"version\":3,\"sources\":[\"webpack://src/Home/index.less\"],\"names\":[],\"mappings\":\"AAAA;EACE,UAAA;EACA,iBAAA;EACA,sBAAA;EACA,kBAAA;AACF\",\"sourcesContent\":[\".line {\\n  color: red;\\n  line-height: 30px;\\n  border: 1px solid #ccc;\\n  border-radius: 5px;\\n}\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\n___CSS_LOADER_EXPORT___.locals = {\n\t\"line\": \"EjoAOH9llLZiIKIOlDX+tA==\"\n};\nexport default ___CSS_LOADER_EXPORT___;\n","\"use strict\";\n\n/*\n  MIT License http://www.opensource.org/licenses/mit-license.php\n  Author Tobias Koppers @sokra\n*/\n// css base code, injected by the css-loader\n// eslint-disable-next-line func-names\nmodule.exports = function (useSourceMap) {\n  var list = []; // return the list of modules as css string\n\n  list.toString = function toString() {\n    return this.map(function (item) {\n      var content = cssWithMappingToString(item, useSourceMap);\n\n      if (item[2]) {\n        return \"@media \".concat(item[2], \" {\").concat(content, \"}\");\n      }\n\n      return content;\n    }).join('');\n  }; // import a list of modules into the list\n  // eslint-disable-next-line func-names\n\n\n  list.i = function (modules, mediaQuery, dedupe) {\n    if (typeof modules === 'string') {\n      // eslint-disable-next-line no-param-reassign\n      modules = [[null, modules, '']];\n    }\n\n    var alreadyImportedModules = {};\n\n    if (dedupe) {\n      for (var i = 0; i < this.length; i++) {\n        // eslint-disable-next-line prefer-destructuring\n        var id = this[i][0];\n\n        if (id != null) {\n          alreadyImportedModules[id] = true;\n        }\n      }\n    }\n\n    for (var _i = 0; _i < modules.length; _i++) {\n      var item = [].concat(modules[_i]);\n\n      if (dedupe && alreadyImportedModules[item[0]]) {\n        // eslint-disable-next-line no-continue\n        continue;\n      }\n\n      if (mediaQuery) {\n        if (!item[2]) {\n          item[2] = mediaQuery;\n        } else {\n          item[2] = \"\".concat(mediaQuery, \" and \").concat(item[2]);\n        }\n      }\n\n      list.push(item);\n    }\n  };\n\n  return list;\n};\n\nfunction cssWithMappingToString(item, useSourceMap) {\n  var content = item[1] || ''; // eslint-disable-next-line prefer-destructuring\n\n  var cssMapping = item[3];\n\n  if (!cssMapping) {\n    return content;\n  }\n\n  if (useSourceMap && typeof btoa === 'function') {\n    var sourceMapping = toComment(cssMapping);\n    var sourceURLs = cssMapping.sources.map(function (source) {\n      return \"/*# sourceURL=\".concat(cssMapping.sourceRoot || '').concat(source, \" */\");\n    });\n    return [content].concat(sourceURLs).concat([sourceMapping]).join('\\n');\n  }\n\n  return [content].join('\\n');\n} // Adapted from convert-source-map (MIT)\n\n\nfunction toComment(sourceMap) {\n  // eslint-disable-next-line no-undef\n  var base64 = btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap))));\n  var data = \"sourceMappingURL=data:application/json;charset=utf-8;base64,\".concat(base64);\n  return \"/*# \".concat(data, \" */\");\n}","interface Item {\n  name: string;\n  age: number;\n}\nexport const list: Item[] = [\n  {\n    name: \"Bob\",\n    age: 20,\n  },\n];\n\nexport const getList = () => {\n  console.log(\"invoke\");\n  return Promise.resolve(list);\n};\n","interface newItem {\n  desc: string;\n  id: number;\n}\n\nexport const newsList: newItem[] = [\n  {\n    desc: \"没什么新闻\",\n    id: 1,\n  },\n];\n\nexport const getNews = async () => {\n  console.log(\"getNews\");\n  return newsList;\n};\n","interface User {\n  name: string;\n  age: number;\n  address: string;\n}\n\nexport const user: User = {\n  name: \"Tim\",\n  age: 200,\n  address: \"sdfasdfasdfasdf\",\n};\n\nexport const getUser = () => {\n  console.log(\"invoke\");\n  return Promise.resolve(user);\n};\n","import express from 'express';\nimport {pageRouter} from './pageRouter';\nconst path = require('path');\nconst app = express();\n\napp.use(express.static(path.join(__dirname, './static')))\napp.use(pageRouter);\n\napp.listen(3000, () => {\n  console.log('server start');\n})","import { Router, Request as ExpressRequest } from \"express\";\nimport { Request, Response } from \"node-fetch\";\nimport {\n  createStaticHandler,\n  createStaticRouter,\n  StaticRouterProvider,\n} from \"react-router-dom/server\";\nimport { renderToString } from \"react-dom/server\";\nimport { routes } from \"../src/router\";\nimport StyleContext from \"isomorphic-style-loader/StyleContext\";\nimport { StaticHandler } from \"@remix-run/router\";\n\n// 构造一个Request对象，React-Router根据它的信息来匹配路由\nconst createRequest = (req: ExpressRequest) => {\n  const origin = `${req.protocol}://${req.get(\"host\")}`;\n  const url = new URL(req.url, origin);\n  const controller = new AbortController();\n  req.on(\"close\", () => controller.abort());\n  const init = {\n    method: req.method,\n    signal: controller.signal,\n  };\n  // @ts-ignore\n  return new Request(url.href, init);\n};\n\nconst pageRouter = Router();\n\ntype QueryReturnType = Awaited<ReturnType<StaticHandler[\"query\"]>>;\ntype StyleItem = {\n  _getContent: () => string[];\n};\n\nfunction isResponse(\n  context: QueryReturnType\n): context is Extract<QueryReturnType, { status: number }> {\n  return context instanceof Response;\n}\n\npageRouter.get(\"*\", async (req, res) => {\n  const { query, dataRoutes } = createStaticHandler(routes);\n  const context = await query(\n    createRequest(req) as unknown as globalThis.Request\n  );\n\n  if (isResponse(context)) {\n    throw context;\n  }\n\n  const styleEls: string[] = [];\n  const insertCss = (...styles: StyleItem[]) => {\n    styles.forEach((style, i) => {\n      const [[id, content]] = style._getContent();\n      styleEls.push(`<style id=\"s${id}-${i}\">${content}</style>`);\n    });\n  };\n\n  const router = createStaticRouter(dataRoutes, context);\n  const str = renderToString(\n    <StyleContext.Provider value={{ insertCss }}>\n      <StaticRouterProvider context={context} router={router} />\n    </StyleContext.Provider>\n  );\n  res.send(`\n    <!DOCTYPE html>\n    <html lang=\"en\">\n    <head>\n      <meta charset=\"UTF-8\">\n      <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n      <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n      <title>Document</title>\n      ${styleEls.join(\"\")}\n      <script src=\"/client.js\" defer></script>\n      <script src=\"/observer.js\" defer></script>\n    </head>\n    <body>\n      <div id=\"root\">${str}</div>\n    </body>\n    </html>\n  `);\n});\n\nexport { pageRouter };\n","import { getList } from \"../../mock/list\";\nimport { useDataFromLoader } from \"../../utils/useDataFromLoader\";\nimport styles from \"./index.less\";\nimport useStyles from \"isomorphic-style-loader/useStyles\";\n\nconst Home = () => {\n  useStyles(styles);\n  const list = useDataFromLoader(Home.loader);\n  return (\n    <div>\n      <span>Hello world!</span>\n\n      {list.map((item) => {\n        return (\n          <div className={styles.line} key={item.name}>\n            {item.name}\n          </div>\n        );\n      })}\n    </div>\n  );\n};\n\nHome.loader = async () => {\n  const data = await getList();\n  return data;\n};\n\nexport { Home };\n","import { Outlet } from \"react-router\";\nimport { getNews } from \"../mock/news\";\nimport { useDataFromLoader } from \"../utils/useDataFromLoader\";\nexport const Layout = () => {\n  const news = useDataFromLoader(Layout.loader);\n  return (\n    <div>\n      Hello world;\n      {news.map((item) => {\n        return <div key={item.id}>{item.desc}</div>;\n      })}\n      <Outlet />\n    </div>\n  );\n};\n\nLayout.loader = getNews;\n","import { getUser } from \"../../mock/user\";\nimport { useDataFromLoader } from \"../../utils/useDataFromLoader\";\n\nconst User = () => {\n  const userInfo = useDataFromLoader(User.loader);\n  return <div>user: {JSON.stringify(userInfo)}</div>;\n};\nUser.loader = async () => {\n  let data = await getUser();\n  return data;\n};\nexport { User };\n","import { RouteObject } from \"react-router\";\nimport { Layout } from \"./Layout\";\nimport { Home } from \"./Home\";\nimport { User } from \"./User\";\n\nexport const routes: RouteObject[] = [\n  {\n    element: <Layout />,\n    path: \"/\",\n    loader: Layout.loader,\n    children: [\n      {\n        element: <Home />,\n        loader: Home.loader,\n        index: true, // 默认\n      },\n      {\n        path: \"user\",\n        element: <User />,\n        loader: User.loader,\n      },\n    ],\n  },\n];\n","import { LoaderFunction, useLoaderData } from \"react-router\";\n\nexport function useDataFromLoader<T extends LoaderFunction>(loaderFn: T) {\n  return useLoaderData() as Awaited<ReturnType<typeof loaderFn>>;\n}\n","module.exports = require(\"express\");","module.exports = require(\"isomorphic-style-loader/StyleContext\");","module.exports = require(\"isomorphic-style-loader/useStyles\");","module.exports = require(\"node-fetch\");","module.exports = require(\"react-dom/server\");","module.exports = require(\"react-router\");","module.exports = require(\"react-router-dom/server\");","module.exports = require(\"react/jsx-runtime\");","module.exports = require(\"path\");","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\tid: moduleId,\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(\"./server/index.ts\");\n",""],"names":[],"sourceRoot":""}